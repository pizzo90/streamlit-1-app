# Press ⌃R to execute it or replace it with your code.
# Press Double ⇧ to search everywhere for classes, files, tool windows, actions, and settings.
import time

import streamlit as st
import os
from langchain.text_splitter import CharacterTextSplitter
from langchain_openai import OpenAIEmbeddings
from langchain_community.vectorstores import FAISS
from langchain_community.chat_models import ChatOpenAI
from langchain.memory import ConversationBufferMemory
from langchain.chains import ConversationalRetrievalChain

os.environ['OPENAI_API_KEY'] = st.secrets['OPENAI_API_KEY']


def split_text(text):
    text = "—il divietodellaclonazione riproduttivadegli esseri umani. Articolo4 Proibizionedella torturaedellepeneotrattamenti inumaniodegradanti Nessunopuòessere sottopostoa tortura, néapeneo trattamenti inumani odegradanti. Articolo5 Proibizionedellaschiavitùedel lavoroforzato 1. Nessunopuòessere tenuto incondizioni di schiavitùodi servitù. 2. Nessunopuòesserecostrettoacompiereun lavoro \n forzatooobbligatorio. 3. Èproibita la trattadegli esseri umani. IT 18.12.2000 GazzettaufficialedelleComunitàeuropee C364/9CAPOII LIBERTÀ Articolo6 Dirittoalla libertàeallasicurezza Ogni individuohadirittoalla libertàealla sicurezza. Articolo7 Rispettodellavitaprivataedellavita familiare \n Ogni individuohadirittoal rispettodellapropriavitaprivatae familiare, delpropriodomicilioedelle suecomunicazioni. Articolo8 Protezionedeidatidi caratterepersonale 1. Ogni individuohadirittoallaprotezionedei dati di caratterepersonaleche loriguardano. 2. Tali dati devonoessere trattati secondo il principiodi lealtà, per finalitàdeterminatee \n inbaseal consensodellapersonainteressataoaunaltrofondamentolegittimoprevistodallalegge.Ogni individuo ha il dirittodi accedereai dati raccolti che loriguardanoedi ottenerne la rettifica. 3. Il rispettodi tali regoleè soggettoal controllodi un'autorità indipendente. Articolo9 Dirittodi sposarsi edi costituireuna famiglia Ildirittodi sposarsieildirittodicostituireunafamigliasonogarantiti secondole legginazionali chene disciplinano l'esercizio. Articolo10 Libertàdipensiero, di coscienzaedi religione 1. Ogni individuohadirittoalla libertàdipensiero,di coscienzaedi religione.Taledirittoinclude la libertàdi \n cambiarereligioneoconvinzione, così come la libertàdimanifestare lapropriareligioneola propria convinzione individualmente o collettivamente, inpubblico o inprivato, mediante il culto, l'insegnamento, lepratichee l'osservanzadei riti. 2. Il dirittoall'obiezionedi coscienza è riconosciutosecondo le leggi nazionali chenedisciplinano l'esercizio. IT C364/10 GazzettaufficialedelleComunitàeuropee 18.12.2000Articolo11 Libertàdi espressioneed'informazione 1. Ogni individuohadirittoalla libertàdi espressione.Taledirittoinclude la libertàdiopinionee la libertàdi ricevereodicomunicareinformazionioideesenzachevipossaessereingerenzadapartedelle autoritàpubblichee senza limiti di frontiera. 2. La libertàdeimediae il loropluralismosonorispettati. Articolo12 Libertàdi riunioneedi associazione 1. Ogni individuoha dirittoalla \n libertà di riunionepacifica e alla libertà di associazione a tutti i livelli, segnatamente incampopolitico, sindacaleecivico, il che implica il dirittodi ogni individuodi fondare sindacati insiemeconaltri edi aderirvi per ladifesadei propri interessi. 2. I partiti politici a livellodell'Unione contribuisconoa esprimere lavolontàpoliticadei cittadini dell'Unione. Articolo13 Libertàdellearti edellescienze Learti e la ricerca scientifica sono libere. La libertàaccademicaè rispettata. Articolo14 Dirittoall'istruzione 1. Ogni individuohadirittoall'istruzioneeall'accessoalla formazioneprofessionaleecontinua. 2. Questodirittocomporta la facoltàdi accederegratuitamenteall'istruzioneobbligatoria. 3. La libertà di creare istituti di insegnamentonel \n rispettodei principi democratici, così come il \n dirittodeigenitoridiprovvedereall'educazioneeall'istruzionedei lorofigli secondole loroconvinzioni religiose, filosoficheepedagogiche, sonorispettati secondole legginazionali chenedisciplinanol'esercizio. Articolo15 Libertàprofessionaleedirittodi lavorare 1. Ogni individuo ha il diritto di lavorare e di esercitare una professione liberamente scelta o accettata. 2. Ogni cittadinodell'Unioneha la libertàdi cercareunlavoro, di lavorare, di stabilirsiodiprestare servizi inqualunqueStatomembro. IT 18.12.2000 GazzettaufficialedelleComunitàeuropee C364/113. I cittadini dei paesi terzi che sonoautorizzati a lavorarenel territoriodegli Statimembri hanno dirittoacondizioni di lavoroequivalenti aquelledi cui godono i cittadini dell'Unione. Articolo16 Libertàd'impresa È riconosciuta la libertà d'impresa, conformemente al diritto comunitario e alle legislazioni e prassi nazionali. Articolo17 Dirittodiproprietà 1. Ogni individuoha il dirittodi godere \n dellaproprietàdei beni cheha acquistato legalmente, di usarli,didisporneedi lasciarli ineredità.Nessunopuòessereprivatodellaproprietàsenonpercausadi pubblicointeresse, nei casi eneimodiprevisti dalla leggeecontroilpagamentointempoutilediuna giusta indennità per la perdita della stessa. L'usodei beni può essere regolatodalla legge nei limiti imposti dall'interessegenerale. 2. Laproprietà intellettualeèprotetta. Articolo18 Dirittodi asilo \n Ildirittodiasiloègarantitonel rispettodellenormestabilitedallaconvenzionediGinevradel28luglio 1951edal protocollodel 31gennaio1967, relativi allostatusdei rifugiati, eanormadel trattatoche istituisce laComunitàeuropea. Articolo19 Protezione incasodi allontanamento, di espulsioneedi estradizione 1. Leespulsioni collettive sonovietate. 2. Nessunopuòessereallontanato, espulsooestradatoversounoStatoincui esisteunrischioserio di esseresottopostoallapenadimorte, allatorturaoadaltrepeneotrattamenti inumaniodegradanti. \n IT C364/12 GazzettaufficialedelleComunitàeuropee 18.12.2000CAPOIII UGUAGLIANZA Articolo20 Uguaglianzadavanti alla legge Tutte lepersone sonouguali davanti alla legge. Articolo21 Nondiscriminazione 1. Èvietataqualsiasi formadi discriminazione fondata, inparticolare, sul sesso, la razza, il colore dellapelleol'origineetnicaosociale, lecaratteristichegenetiche, la lingua, lareligioneoleconvinzioni personali, leopinionipoliticheodiqualsiasi altranatura, l'appartenenzaadunaminoranzanazionale, il patrimonio, lanascita, gli handicap, l'etào le tendenze sessuali. 2. Nell'ambitod'applicazionedel trattatoche istituisce laComunitàeuropeaedel trattatosull'Unione europea è vietataqualsiasi discriminazione fondata sulla cittadinanza, fatte salve ledisposizioni particolari contenutenei trattati stessi. Articolo22 Diversitàculturale, religiosae linguistica L'Unione rispetta ladiversitàculturale, religiosae linguistica. Articolo23 Parità trauomini edonne Laparitàtrauominiedonnedeveessereassicurataintutti icampi,compresoinmateriadioccupazione, di lavoroedi retribuzione. Il principiodella parità nonosta almantenimentoo all'adozione dimisure che prevedanovantaggi specifici a favoredel sessosottorappresentato. Articolo24 Dirittidelbambino 1. I bambini hannodirittoallaprotezioneeallecurenecessarieper il lorobenessere. Essi possono esprimere liberamente lapropriaopinione; questavienepresa inconsiderazione sullequestioni che li riguardano in funzionedella loroetàedella loromaturità. 2. Intuttigliatti relativiaibambini, sianoessicompiutidaautoritàpubblicheodaistituzioniprivate, l'interesse superioredel bambinodeveessereconsideratopreminente. IT 18.12.2000 GazzettaufficialedelleComunitàeuropee C364/133. Ognibambinohadirittodi intrattenereregolarmenterelazionipersonaliecontattidiretticonidue genitori, salvoqualoraciòsiacontrarioal suo interesse. Articolo25 Dirittidegli anziani L'Unione riconosceerispetta il dirittodegli anziani di condurreunavitadignitosae indipendenteedi partecipareallavita socialeeculturale. Articolo26 Inserimentodeidisabili L'Unione riconosceerispetta il dirittodei disabili di beneficiaredimisure inteseagarantirne l'autonomia, l'inserimentosocialeeprofessionalee lapartecipazioneallavitadellacomunità. IT C364/14 GazzettaufficialedelleComunitàeuropee 18.12.2000CAPOIV SOLIDARIETÀ Articolo27 Dirittodei lavoratori all'informazioneeallaconsultazionenell'ambitodell'impresa Ai lavoratori oai lororappresentanti devonoesseregarantite, ai livelli appropriati, l'informazionee la consultazioneintempoutileneicasieallecondizioniprevistidaldirittocomunitarioedallelegislazioni eprassi nazionali. Articolo28 Dirittodinegoziazioneedi azioni collettive I lavoratori e i datori di lavoro, o le rispettiveorganizzazioni, hanno, conformementeal dirittocomunitarioealle legislazioni eprassinazionali, il dirittodinegoziareedi concluderecontratti collettivi, ai livelliappropriati, edi ricorrere, incasodiconflittidi interessi, adazioni collettiveper ladifesadei loro interessi, compreso losciopero. Articolo29 Dirittodi accessoai servizidi collocamento Ogni individuoha il dirittodi accedereaunserviziodi collocamentogratuito. Articolo30 Tutela incasodi licenziamentoingiustificato Ogni lavoratorehaildirittoallatutelacontroogni licenziamentoingiustificato,conformementealdiritto comunitarioealle legislazioni eprassi nazionali. Articolo31 Condizionidi lavorogiusteedeque 1. Ogni lavoratorehadirittoacondizioni di lavorosane, sicureedignitose. 2. Ogni lavoratorehadirittoauna limitazionedelladuratamassimadel lavoroeaperiodidi riposo giornalieri e settimanali ea ferieannuali retribuite. IT 18.12.2000 GazzettaufficialedelleComunitàeuropee C364/15Articolo32 Divietodel lavorominorileeprotezionedei giovani sul luogodi lavoro Il lavorominorileèvietato. L'etàminimaper l'ammissioneal lavorononpuòessere inferioreall'età in cui termina la scuoladell'obbligo, fatte salve lenormepiù favorevoli ai giovani edeccettuatederoghe limitate. Igiovaniammessial lavorodevonobeneficiaredicondizionidi lavoroappropriateallaloroetàedessere protetti contro lo sfruttamento economicoo controogni lavoro che possaminarne la sicurezza, la salute, lo sviluppo fisico,mentale,moraleo socialeochepossamettere a rischio la loro istruzione. Articolo33 Vita familiareevitaprofessionale 1. Ègarantita laprotezionedella famiglia sul pianogiuridico, economicoe sociale. 2. Al finedipoter conciliarevita familiareevitaprofessionale, ogni individuoha il dirittodi essere tutelato contro il licenziamento per unmotivo legato allamaternità e il diritto a un congedo di maternità retribuitoeauncongedoparentaledopo lanascitao l'adozionedi unfiglio. Articolo34 Sicurezzasocialeeassistenzasociale 1. L'Unione riconoscee rispetta il dirittodi accessoalleprestazioni di sicurezza socialeeai servizi sociali che assicurano protezione in casi quali lamaternità, lamalattia, gli infortuni sul lavoro, la dipendenzaolavecchiaia,oltreche incasodiperditadelpostodi lavoro, secondolemodalitàstabilite dal dirittocomunitarioe le legislazioni eprassi nazionali. 2. Ogni individuocherisiedaosi sposti legalmenteall'internodell'Unionehadirittoalleprestazioni di sicurezzasocialeeaibenefici sociali conformementealdirittocomunitarioealle legislazioni eprassi nazionali. 3. Al finedi lottare contro l'esclusione sociale e lapovertà, l'Unione riconosce e rispetta il diritto all'assistenza sociale e all'assistenza abitativavolte agarantireun'esistenzadignitosa a tutti coloroche nondisponganodi risorse sufficienti, secondo lemodalità stabilite dal diritto comunitario e le legislazioni eprassi nazionali. Articolo35 Protezionedellasalute Ogni individuo ha il diritto di accedere alla prevenzione sanitaria e di ottenere curemediche alle condizioni stabilite dalle legislazioni e prassi nazionali. Nella definizione e nell'attuazione \n di tutte le politicheedattivitàdell'Unioneègarantitoun livelloelevatodi protezionedella saluteumana. IT C364/16 GazzettaufficialedelleComunitàeuropee 18.12.2000Articolo36 Accessoai servizid'interesseeconomicogenerale Al finedipromuovere lacoesionesocialee territorialedell'Unione, questariconosceerispetta l'accesso ai servizi d'interesse economicogeneralequaleprevistodalle legislazioni eprassi nazionali, conformementeal trattatoche istituisce laComunitàeuropea. Articolo37 Tuteladell'ambiente Unlivelloelevatodi tuteladell'ambienteeilmiglioramentodellasuaqualitàdevonoessereintegratinelle politichedell'Unioneegarantiti conformementeal principiodellosvilupposostenibile. Articolo38 Protezionedei consumatori Nellepolitichedell'Unioneègarantitoun livelloelevatodi protezionedei consumatori. IT 18.12.2000 GazzettaufficialedelleComunitàeuropee C364/17CAPOV CITTADINANZA Articolo39 Dirittodivotoedi eleggibilitàalleelezionidel Parlamentoeuropeo 1. Ognicittadinodell'UnionehaildirittodivotoedieleggibilitàalleelezionidelParlamentoeuropeo nelloStatomembro incui risiede, alle stessecondizioni dei cittadini di dettoStato. 2. Imembri del Parlamentoeuropeosonoeletti a suffragiouniversalediretto, liberoe segreto. Articolo40 Dirittodivotoedi eleggibilitàalleelezioni comunali Ognicittadinodell'UnionehaildirittodivotoedieleggibilitàalleelezionicomunalinelloStatomembro incui risiede, alle stessecondizioni dei cittadini di dettoStato. Articolo41 Dirittoadunabuonaamministrazione 1. Ogni individuohadirittoache lequestioni che loriguardanosianotrattate inmodo imparziale, equoedentrountermine ragionevoledalle istituzioni edagli organi dell'Unione. 2. Taledirittocomprende inparticolare: —il diritto di ogni individuo di essere ascoltato prima che nei suoi confronti venga adottato un provvedimento individualechegli rechi pregiudizio, —ildirittodiogni individuodi accedereal fascicoloche loriguarda,nel rispettodei legittimi interessi della riservatezzaedel segretoprofessionale, —l'obbligoper l'amministrazionedimotivare lepropriedecisioni. 3. Ogni individuohadirittoal risarcimentodapartedellaComunitàdei danni cagionati dalle sue istituzioniodai suoiagentinell'eserciziodelle lorofunzioni conformementeaiprincipigenerali comuni agli ordinamenti degli Statimembri. 4. Ogni individuopuò rivolgersi alle istituzioni dell'Unione inunadelle lingue del trattatoe deve ricevereuna rispostanella stessa lingua. IT C364/18 GazzettaufficialedelleComunitàeuropee 18.12.2000Articolo42 Dirittod'accessoaidocumenti Qualsiasicittadinodell'Unioneoqualsiasipersonafisicaogiuridicacherisiedaoabbialasedesocialein unoStatomembroha il dirittodi accedereai documenti del Parlamentoeuropeo, delConsiglioedella Commissione. Articolo43 Mediatore Qualsiasicittadinodell'Unioneoqualsiasipersonafisicaogiuridicacherisiedaoabbialasedesocialein unoStatomembroha il dirittodi sottoporrealmediatoredell'Unionecasi di cattivaamministrazione nell'azionedelle istituzioniodegliorgani comunitari, salvolaCortedi giustiziae ilTribunalediprimo gradonell'eserciziodelle loro funzioni giurisdizionali. Articolo44 Dirittodipetizione Qualsiasicittadinodell'Unioneoqualsiasipersonafisicaogiuridicacherisiedaoabbialasedesocialein unoStatomembroha il dirittodi presentareunapetizioneal Parlamentoeuropeo. Articolo45 Libertàdi circolazioneedi soggiorno 1. Ogni cittadinodell'Unionehaildirittodi circolareedi soggiornare liberamentenel territoriodegli Statimembri. 2. La libertà di circolazione e di soggiornopuò essere accordata, conformemente al trattato che istituisce laComunità europea, ai cittadini dei paesi terzi che risiedono legalmente nel territoriodi unoStatomembro. Articolo46 Tuteladiplomaticaeconsolare Ogni cittadinodell'Unionegode,nel territoriodiunpaeseterzonelquale loStatomembrodi cuiha la cittadinanzanonè rappresentato, della tuteladelleautoritàdiplomatiche e consolari di qualsiasi Stato membro, alle stessecondizioni dei cittadini di dettoStato. IT 18.12.2000 GazzettaufficialedelleComunitàeuropee C364/19CAPOVI GIUSTIZIA Articolo47 Dirittoaunricorsoeffettivoeaungiudice imparziale Ogni individuoi cuidiritti e lecui libertàgarantitidaldirittodell'Unionesianostati violatihadirittoa un ricorso effettivodinanzi aungiudice, nel rispettodelle condizioni previste nel presente articolo. Ogni individuoha diritto a che la sua causa sia esaminata equamente, pubblicamente ed entroun termine ragionevoledaungiudice indipendente e imparziale, precostituitoper legge.Ogni individuo ha la facoltàdi farsi consigliare, difenderee rappresentare. Acolorochenondispongonodimezzi sufficientièconcessoilpatrocinioaspesedelloStatoqualoraciò sianecessarioper assicurareunaccessoeffettivoallagiustizia. Articolo48 Presunzionedi innocenzaedirittidelladifesa 1. Ogni imputatoèconsideratoinnocentefinoaquandolasuacolpevolezzanonsiastatalegalmente provata. 2. Il rispettodei diritti delladifesaègarantitoadogni imputato. Articolo49 Principidella legalitàedellaproporzionalitàdei reati edellepene 1. Nessunopuò essere condannatoper un'azione oun'omissione che, almomento in cui è stata commessa,noncostituivareatosecondoildirittointernooildirittointernazionale. Parimenti,nonpuò essere inflittaunapenapiùgravediquellaapplicabilealmomentoincui il reatoèstatocommesso. Se, successivamente alla commissione del reato, la legge prevede l'applicazione di una pena più lieve, occorreapplicarequest'ultima. 2. Ilpresentearticolononostaalgiudizioeallacondannadiunapersonacolpevolediun'azioneodi un'omissioneche,almomentoincuièstatacommessa,costituivauncriminesecondoiprincipigenerali riconosciuti da tutte lenazioni. 3. Lepene inflittenondevonoessere sproporzionate rispettoal reato. Articolo50 Dirittodinonesseregiudicatoopunitoduevolteper lostessoreato Nessunopuòessereperseguitoocondannatoperunreatoper ilqualeègiàstatoassoltoocondannato nell'Unionea seguitodi \n una sentenzapenaledefinitivaconformementealla legge. IT C364/20 GazzettaufficialedelleComunitàeuropee 18.12.2000CAPOVII DISPOSIZIONIGENERALI Articolo51 Ambitodi applicazione 1. Le disposizioni della presente Carta si applicano alle istituzioni e agli organi dell'Unione nel rispettodel principiodi sussidiarietà come pure agli Statimembri esclusivamente nell'attuazione del dirittodell'Unione.Pertanto, i suddetti soggetti rispettanoidiritti,osservanoiprincipienepromuovono l'applicazione secondo le rispettivecompetenze. 2. La presente Carta non introduce competenze nuove o compiti nuovi per la Comunità e per l'Unione, némodifica lecompetenzee i compiti definiti dai trattati. Articolo52 Portatadeidiritti garantiti 1. Eventuali limitazioni all'eserciziodei diritti edelle libertàriconosciuti dallapresenteCartadevono essereprevistedalla legge e rispettare il contenutoessenzialedi detti diritti e libertà.Nel rispettodel principio di proporzionalità, possono essere apportate limitazioni solo laddove siano necessarie e rispondano effettivamente a finalità di interesse generale riconosciute dall'Unione o all'esigenza di proteggere i diritti e le libertàaltrui. 2. I diritti riconosciuti dalla presenteCarta che trovano fondamentonei trattati comunitari onel trattatosull'Unioneeuropea si esercitanoallecondizioni enei limiti definiti dai trattati stessi. 3. Laddove la presente Carta contenga diritti corrispondenti a quelli garantiti dalla convenzione europeaper la salvaguardiadei diritti dell'uomoedelle libertà fondamentali, il significatoe laportata degli stessi sono uguali a quelli conferiti dalla suddetta convenzione. La presente disposizione non precludeche il dirittodell'Unioneconcedaunaprotezionepiùestesa. Articolo53 Livellodiprotezione Nessuna disposizione dellapresenteCartadeve essere interpretata come limitativao lesiva dei diritti dell'uomo e delle libertà fondamentali riconosciuti, nel rispettivo ambitodi applicazione, dal diritto dell'Unione,daldirittointernazionale,dalleconvenzioni internazionalidellequali l'Unione, laComunità otuttigliStatimembri sonoparti contraenti, inparticolare laconvenzioneeuropeaper lasalvaguardia dei diritti dell'uomoedelle libertà fondamentali, edallecostituzioni degli Statimembri. IT 18.12.2000 GazzettaufficialedelleComunitàeuropee C364/21Articolo54 Divietodell'abusodidiritto NessunadisposizionedellapresenteCartadeveessere interpretatanel sensodi comportare il dirittodi esercitareun'attivitàocompiereunattochemiri alladistruzionedei diritti odelle libertà riconosciuti nellapresenteCartaodi imporre a tali diritti e libertà limitazioni piùampiedi quelleprevistedalla presenteCarta."
    splitted_text = CharacterTextSplitter(
        separator='\n',
        chunk_size=500,
        chunk_overlap=50,
        length_function=len
    )
    return splitted_text.split_text(text)


def get_conversation(vectorstore):
    llm = ChatOpenAI()
    memory = ConversationBufferMemory(memory_key='chat_history', return_messages=True)
    conv_chain = ConversationalRetrievalChain.from_llm(
        llm=llm,
        retriever=vectorstore.as_retriever(),
        memory=memory
    )
    return conv_chain


def get_vectorstore(chunks):
    embedding = OpenAIEmbeddings(show_progress_bar=True)
    vectors = FAISS.from_texts(texts=chunks, embedding=embedding)
    return vectors


def handle_question(question):
    response = st.session_state.conversation({'question': question})
    st.session_state.chat_history = response['chat_history']

    for i, message in enumerate(st.session_state.chat_history):
        st.write(message.content)


def main():
    if "conversation" not in st.session_state:
        st.session_state.conversation = None

    if "chat_history" not in st.session_state:
        st.session_state.chat_history = None

    if 'splitted_text' not in st.session_state:
        st.session_state.splitted_text = None

    if 'vectors' not in st.session_state:
        st.session_state.vectors = None
        st.session_state.vectors = get_vectorstore(split_text('test'))

    st.title('🫸🫷:heart: LangChain first app')
    with st.sidebar:
        with st.echo():
            st.write("This code will be printed to the sidebar.")
        st.success("Done!")

    user_question = st.text_input('ask here about the document')
    if user_question:
        handle_question(user_question)
    st.session_state.conversation = get_conversation(st.session_state.vectors)


# Press the green button in the gutter to run the script.
if __name__ == '__main__':
    main()

# See PyCharm help at https://www.jetbrains.com/help/pycharm/
