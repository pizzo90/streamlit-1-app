# Press ‚åÉR to execute it or replace it with your code.
# Press Double ‚áß to search everywhere for classes, files, tool windows, actions, and settings.
import time

import streamlit as st
import os
from langchain.text_splitter import CharacterTextSplitter
from langchain_openai import OpenAIEmbeddings
from langchain_community.vectorstores import FAISS
from langchain_community.chat_models import ChatOpenAI
from langchain.memory import ConversationBufferMemory
from langchain.chains import ConversationalRetrievalChain

os.environ['OPENAI_API_KEY'] = st.secrets['OPENAI_API_KEY']


def split_text(text):
    text = "‚Äîil divietodellaclonazione riproduttivadegli esseri umani. Articolo4 Proibizionedella torturaedellepeneotrattamenti inumaniodegradanti Nessunopu√≤essere sottopostoa tortura, n√©apeneo trattamenti inumani odegradanti. Articolo5 Proibizionedellaschiavit√πedel lavoroforzato 1. Nessunopu√≤essere tenuto incondizioni di schiavit√πodi servit√π. 2. Nessunopu√≤esserecostrettoacompiereun lavoro \n forzatooobbligatorio. 3. √àproibita la trattadegli esseri umani. IT 18.12.2000 GazzettaufficialedelleComunit√†europee C364/9CAPOII LIBERT√Ä Articolo6 Dirittoalla libert√†eallasicurezza Ogni individuohadirittoalla libert√†ealla sicurezza. Articolo7 Rispettodellavitaprivataedellavita familiare \n Ogni individuohadirittoal rispettodellapropriavitaprivatae familiare, delpropriodomicilioedelle suecomunicazioni. Articolo8 Protezionedeidatidi caratterepersonale 1. Ogni individuohadirittoallaprotezionedei dati di caratterepersonaleche loriguardano. 2. Tali dati devonoessere trattati secondo il principiodi lealt√†, per finalit√†determinatee \n inbaseal consensodellapersonainteressataoaunaltrofondamentolegittimoprevistodallalegge.Ogni individuo ha il dirittodi accedereai dati raccolti che loriguardanoedi ottenerne la rettifica. 3. Il rispettodi tali regole√® soggettoal controllodi un'autorit√† indipendente. Articolo9 Dirittodi sposarsi edi costituireuna famiglia Ildirittodi sposarsieildirittodicostituireunafamigliasonogarantiti secondole legginazionali chene disciplinano l'esercizio. Articolo10 Libert√†dipensiero, di coscienzaedi religione 1. Ogni individuohadirittoalla libert√†dipensiero,di coscienzaedi religione.Taledirittoinclude la libert√†di \n cambiarereligioneoconvinzione, cos√¨ come la libert√†dimanifestare lapropriareligioneola propria convinzione individualmente o collettivamente, inpubblico o inprivato, mediante il culto, l'insegnamento, lepratichee l'osservanzadei riti. 2. Il dirittoall'obiezionedi coscienza √® riconosciutosecondo le leggi nazionali chenedisciplinano l'esercizio. IT C364/10 GazzettaufficialedelleComunit√†europee 18.12.2000Articolo11 Libert√†di espressioneed'informazione 1. Ogni individuohadirittoalla libert√†di espressione.Taledirittoinclude la libert√†diopinionee la libert√†di ricevereodicomunicareinformazionioideesenzachevipossaessereingerenzadapartedelle autorit√†pubblichee senza limiti di frontiera. 2. La libert√†deimediae il loropluralismosonorispettati. Articolo12 Libert√†di riunioneedi associazione 1. Ogni individuoha dirittoalla \n libert√† di riunionepacifica e alla libert√† di associazione a tutti i livelli, segnatamente incampopolitico, sindacaleecivico, il che implica il dirittodi ogni individuodi fondare sindacati insiemeconaltri edi aderirvi per ladifesadei propri interessi. 2. I partiti politici a livellodell'Unione contribuisconoa esprimere lavolont√†politicadei cittadini dell'Unione. Articolo13 Libert√†dellearti edellescienze Learti e la ricerca scientifica sono libere. La libert√†accademica√® rispettata. Articolo14 Dirittoall'istruzione 1. Ogni individuohadirittoall'istruzioneeall'accessoalla formazioneprofessionaleecontinua. 2. Questodirittocomporta la facolt√†di accederegratuitamenteall'istruzioneobbligatoria. 3. La libert√† di creare istituti di insegnamentonel \n rispettodei principi democratici, cos√¨ come il \n dirittodeigenitoridiprovvedereall'educazioneeall'istruzionedei lorofigli secondole loroconvinzioni religiose, filosoficheepedagogiche, sonorispettati secondole legginazionali chenedisciplinanol'esercizio. Articolo15 Libert√†professionaleedirittodi lavorare 1. Ogni individuo ha il diritto di lavorare e di esercitare una professione liberamente scelta o accettata. 2. Ogni cittadinodell'Unioneha la libert√†di cercareunlavoro, di lavorare, di stabilirsiodiprestare servizi inqualunqueStatomembro. IT 18.12.2000 GazzettaufficialedelleComunit√†europee C364/113. I cittadini dei paesi terzi che sonoautorizzati a lavorarenel territoriodegli Statimembri hanno dirittoacondizioni di lavoroequivalenti aquelledi cui godono i cittadini dell'Unione. Articolo16 Libert√†d'impresa √à riconosciuta la libert√† d'impresa, conformemente al diritto comunitario e alle legislazioni e prassi nazionali. Articolo17 Dirittodipropriet√† 1. Ogni individuoha il dirittodi godere \n dellapropriet√†dei beni cheha acquistato legalmente, di usarli,didisporneedi lasciarli ineredit√†.Nessunopu√≤essereprivatodellapropriet√†senonpercausadi pubblicointeresse, nei casi eneimodiprevisti dalla leggeecontroilpagamentointempoutilediuna giusta indennit√† per la perdita della stessa. L'usodei beni pu√≤ essere regolatodalla legge nei limiti imposti dall'interessegenerale. 2. Lapropriet√† intellettuale√®protetta. Articolo18 Dirittodi asilo \n Ildirittodiasilo√®garantitonel rispettodellenormestabilitedallaconvenzionediGinevradel28luglio 1951edal protocollodel 31gennaio1967, relativi allostatusdei rifugiati, eanormadel trattatoche istituisce laComunit√†europea. Articolo19 Protezione incasodi allontanamento, di espulsioneedi estradizione 1. Leespulsioni collettive sonovietate. 2. Nessunopu√≤essereallontanato, espulsooestradatoversounoStatoincui esisteunrischioserio di esseresottopostoallapenadimorte, allatorturaoadaltrepeneotrattamenti inumaniodegradanti. \n IT C364/12 GazzettaufficialedelleComunit√†europee 18.12.2000CAPOIII UGUAGLIANZA Articolo20 Uguaglianzadavanti alla legge Tutte lepersone sonouguali davanti alla legge. Articolo21 Nondiscriminazione 1. √àvietataqualsiasi formadi discriminazione fondata, inparticolare, sul sesso, la razza, il colore dellapelleol'origineetnicaosociale, lecaratteristichegenetiche, la lingua, lareligioneoleconvinzioni personali, leopinionipoliticheodiqualsiasi altranatura, l'appartenenzaadunaminoranzanazionale, il patrimonio, lanascita, gli handicap, l'et√†o le tendenze sessuali. 2. Nell'ambitod'applicazionedel trattatoche istituisce laComunit√†europeaedel trattatosull'Unione europea √® vietataqualsiasi discriminazione fondata sulla cittadinanza, fatte salve ledisposizioni particolari contenutenei trattati stessi. Articolo22 Diversit√†culturale, religiosae linguistica L'Unione rispetta ladiversit√†culturale, religiosae linguistica. Articolo23 Parit√† trauomini edonne Laparit√†trauominiedonnedeveessereassicurataintutti icampi,compresoinmateriadioccupazione, di lavoroedi retribuzione. Il principiodella parit√† nonosta almantenimentoo all'adozione dimisure che prevedanovantaggi specifici a favoredel sessosottorappresentato. Articolo24 Dirittidelbambino 1. I bambini hannodirittoallaprotezioneeallecurenecessarieper il lorobenessere. Essi possono esprimere liberamente lapropriaopinione; questavienepresa inconsiderazione sullequestioni che li riguardano in funzionedella loroet√†edella loromaturit√†. 2. Intuttigliatti relativiaibambini, sianoessicompiutidaautorit√†pubblicheodaistituzioniprivate, l'interesse superioredel bambinodeveessereconsideratopreminente. IT 18.12.2000 GazzettaufficialedelleComunit√†europee C364/133. Ognibambinohadirittodi intrattenereregolarmenterelazionipersonaliecontattidiretticonidue genitori, salvoqualoraci√≤siacontrarioal suo interesse. Articolo25 Dirittidegli anziani L'Unione riconosceerispetta il dirittodegli anziani di condurreunavitadignitosae indipendenteedi partecipareallavita socialeeculturale. Articolo26 Inserimentodeidisabili L'Unione riconosceerispetta il dirittodei disabili di beneficiaredimisure inteseagarantirne l'autonomia, l'inserimentosocialeeprofessionalee lapartecipazioneallavitadellacomunit√†. IT C364/14 GazzettaufficialedelleComunit√†europee 18.12.2000CAPOIV SOLIDARIET√Ä Articolo27 Dirittodei lavoratori all'informazioneeallaconsultazionenell'ambitodell'impresa Ai lavoratori oai lororappresentanti devonoesseregarantite, ai livelli appropriati, l'informazionee la consultazioneintempoutileneicasieallecondizioniprevistidaldirittocomunitarioedallelegislazioni eprassi nazionali. Articolo28 Dirittodinegoziazioneedi azioni collettive I lavoratori e i datori di lavoro, o le rispettiveorganizzazioni, hanno, conformementeal dirittocomunitarioealle legislazioni eprassinazionali, il dirittodinegoziareedi concluderecontratti collettivi, ai livelliappropriati, edi ricorrere, incasodiconflittidi interessi, adazioni collettiveper ladifesadei loro interessi, compreso losciopero. Articolo29 Dirittodi accessoai servizidi collocamento Ogni individuoha il dirittodi accedereaunserviziodi collocamentogratuito. Articolo30 Tutela incasodi licenziamentoingiustificato Ogni lavoratorehaildirittoallatutelacontroogni licenziamentoingiustificato,conformementealdiritto comunitarioealle legislazioni eprassi nazionali. Articolo31 Condizionidi lavorogiusteedeque 1. Ogni lavoratorehadirittoacondizioni di lavorosane, sicureedignitose. 2. Ogni lavoratorehadirittoauna limitazionedelladuratamassimadel lavoroeaperiodidi riposo giornalieri e settimanali ea ferieannuali retribuite. IT 18.12.2000 GazzettaufficialedelleComunit√†europee C364/15Articolo32 Divietodel lavorominorileeprotezionedei giovani sul luogodi lavoro Il lavorominorile√®vietato. L'et√†minimaper l'ammissioneal lavorononpu√≤essere inferioreall'et√† in cui termina la scuoladell'obbligo, fatte salve lenormepi√π favorevoli ai giovani edeccettuatederoghe limitate. Igiovaniammessial lavorodevonobeneficiaredicondizionidi lavoroappropriateallaloroet√†edessere protetti contro lo sfruttamento economicoo controogni lavoro che possaminarne la sicurezza, la salute, lo sviluppo fisico,mentale,moraleo socialeochepossamettere a rischio la loro istruzione. Articolo33 Vita familiareevitaprofessionale 1. √àgarantita laprotezionedella famiglia sul pianogiuridico, economicoe sociale. 2. Al finedipoter conciliarevita familiareevitaprofessionale, ogni individuoha il dirittodi essere tutelato contro il licenziamento per unmotivo legato allamaternit√† e il diritto a un congedo di maternit√† retribuitoeauncongedoparentaledopo lanascitao l'adozionedi unfiglio. Articolo34 Sicurezzasocialeeassistenzasociale 1. L'Unione riconoscee rispetta il dirittodi accessoalleprestazioni di sicurezza socialeeai servizi sociali che assicurano protezione in casi quali lamaternit√†, lamalattia, gli infortuni sul lavoro, la dipendenzaolavecchiaia,oltreche incasodiperditadelpostodi lavoro, secondolemodalit√†stabilite dal dirittocomunitarioe le legislazioni eprassi nazionali. 2. Ogni individuocherisiedaosi sposti legalmenteall'internodell'Unionehadirittoalleprestazioni di sicurezzasocialeeaibenefici sociali conformementealdirittocomunitarioealle legislazioni eprassi nazionali. 3. Al finedi lottare contro l'esclusione sociale e lapovert√†, l'Unione riconosce e rispetta il diritto all'assistenza sociale e all'assistenza abitativavolte agarantireun'esistenzadignitosa a tutti coloroche nondisponganodi risorse sufficienti, secondo lemodalit√† stabilite dal diritto comunitario e le legislazioni eprassi nazionali. Articolo35 Protezionedellasalute Ogni individuo ha il diritto di accedere alla prevenzione sanitaria e di ottenere curemediche alle condizioni stabilite dalle legislazioni e prassi nazionali. Nella definizione e nell'attuazione \n di tutte le politicheedattivit√†dell'Unione√®garantitoun livelloelevatodi protezionedella saluteumana. IT C364/16 GazzettaufficialedelleComunit√†europee 18.12.2000Articolo36 Accessoai servizid'interesseeconomicogenerale Al finedipromuovere lacoesionesocialee territorialedell'Unione, questariconosceerispetta l'accesso ai servizi d'interesse economicogeneralequaleprevistodalle legislazioni eprassi nazionali, conformementeal trattatoche istituisce laComunit√†europea. Articolo37 Tuteladell'ambiente Unlivelloelevatodi tuteladell'ambienteeilmiglioramentodellasuaqualit√†devonoessereintegratinelle politichedell'Unioneegarantiti conformementeal principiodellosvilupposostenibile. Articolo38 Protezionedei consumatori Nellepolitichedell'Unione√®garantitoun livelloelevatodi protezionedei consumatori. IT 18.12.2000 GazzettaufficialedelleComunit√†europee C364/17CAPOV CITTADINANZA Articolo39 Dirittodivotoedi eleggibilit√†alleelezionidel Parlamentoeuropeo 1. Ognicittadinodell'Unionehaildirittodivotoedieleggibilit√†alleelezionidelParlamentoeuropeo nelloStatomembro incui risiede, alle stessecondizioni dei cittadini di dettoStato. 2. Imembri del Parlamentoeuropeosonoeletti a suffragiouniversalediretto, liberoe segreto. Articolo40 Dirittodivotoedi eleggibilit√†alleelezioni comunali Ognicittadinodell'Unionehaildirittodivotoedieleggibilit√†alleelezionicomunalinelloStatomembro incui risiede, alle stessecondizioni dei cittadini di dettoStato. Articolo41 Dirittoadunabuonaamministrazione 1. Ogni individuohadirittoache lequestioni che loriguardanosianotrattate inmodo imparziale, equoedentrountermine ragionevoledalle istituzioni edagli organi dell'Unione. 2. Taledirittocomprende inparticolare: ‚Äîil diritto di ogni individuo di essere ascoltato prima che nei suoi confronti venga adottato un provvedimento individualechegli rechi pregiudizio, ‚Äîildirittodiogni individuodi accedereal fascicoloche loriguarda,nel rispettodei legittimi interessi della riservatezzaedel segretoprofessionale, ‚Äîl'obbligoper l'amministrazionedimotivare lepropriedecisioni. 3. Ogni individuohadirittoal risarcimentodapartedellaComunit√†dei danni cagionati dalle sue istituzioniodai suoiagentinell'eserciziodelle lorofunzioni conformementeaiprincipigenerali comuni agli ordinamenti degli Statimembri. 4. Ogni individuopu√≤ rivolgersi alle istituzioni dell'Unione inunadelle lingue del trattatoe deve ricevereuna rispostanella stessa lingua. IT C364/18 GazzettaufficialedelleComunit√†europee 18.12.2000Articolo42 Dirittod'accessoaidocumenti Qualsiasicittadinodell'Unioneoqualsiasipersonafisicaogiuridicacherisiedaoabbialasedesocialein unoStatomembroha il dirittodi accedereai documenti del Parlamentoeuropeo, delConsiglioedella Commissione. Articolo43 Mediatore Qualsiasicittadinodell'Unioneoqualsiasipersonafisicaogiuridicacherisiedaoabbialasedesocialein unoStatomembroha il dirittodi sottoporrealmediatoredell'Unionecasi di cattivaamministrazione nell'azionedelle istituzioniodegliorgani comunitari, salvolaCortedi giustiziae ilTribunalediprimo gradonell'eserciziodelle loro funzioni giurisdizionali. Articolo44 Dirittodipetizione Qualsiasicittadinodell'Unioneoqualsiasipersonafisicaogiuridicacherisiedaoabbialasedesocialein unoStatomembroha il dirittodi presentareunapetizioneal Parlamentoeuropeo. Articolo45 Libert√†di circolazioneedi soggiorno 1. Ogni cittadinodell'Unionehaildirittodi circolareedi soggiornare liberamentenel territoriodegli Statimembri. 2. La libert√† di circolazione e di soggiornopu√≤ essere accordata, conformemente al trattato che istituisce laComunit√† europea, ai cittadini dei paesi terzi che risiedono legalmente nel territoriodi unoStatomembro. Articolo46 Tuteladiplomaticaeconsolare Ogni cittadinodell'Unionegode,nel territoriodiunpaeseterzonelquale loStatomembrodi cuiha la cittadinanzanon√® rappresentato, della tuteladelleautorit√†diplomatiche e consolari di qualsiasi Stato membro, alle stessecondizioni dei cittadini di dettoStato. IT 18.12.2000 GazzettaufficialedelleComunit√†europee C364/19CAPOVI GIUSTIZIA Articolo47 Dirittoaunricorsoeffettivoeaungiudice imparziale Ogni individuoi cuidiritti e lecui libert√†garantitidaldirittodell'Unionesianostati violatihadirittoa un ricorso effettivodinanzi aungiudice, nel rispettodelle condizioni previste nel presente articolo. Ogni individuoha diritto a che la sua causa sia esaminata equamente, pubblicamente ed entroun termine ragionevoledaungiudice indipendente e imparziale, precostituitoper legge.Ogni individuo ha la facolt√†di farsi consigliare, difenderee rappresentare. Acolorochenondispongonodimezzi sufficienti√®concessoilpatrocinioaspesedelloStatoqualoraci√≤ sianecessarioper assicurareunaccessoeffettivoallagiustizia. Articolo48 Presunzionedi innocenzaedirittidelladifesa 1. Ogni imputato√®consideratoinnocentefinoaquandolasuacolpevolezzanonsiastatalegalmente provata. 2. Il rispettodei diritti delladifesa√®garantitoadogni imputato. Articolo49 Principidella legalit√†edellaproporzionalit√†dei reati edellepene 1. Nessunopu√≤ essere condannatoper un'azione oun'omissione che, almomento in cui √® stata commessa,noncostituivareatosecondoildirittointernooildirittointernazionale. Parimenti,nonpu√≤ essere inflittaunapenapi√πgravediquellaapplicabilealmomentoincui il reato√®statocommesso. Se, successivamente alla commissione del reato, la legge prevede l'applicazione di una pena pi√π lieve, occorreapplicarequest'ultima. 2. Ilpresentearticolononostaalgiudizioeallacondannadiunapersonacolpevolediun'azioneodi un'omissioneche,almomentoincui√®statacommessa,costituivauncriminesecondoiprincipigenerali riconosciuti da tutte lenazioni. 3. Lepene inflittenondevonoessere sproporzionate rispettoal reato. Articolo50 Dirittodinonesseregiudicatoopunitoduevolteper lostessoreato Nessunopu√≤essereperseguitoocondannatoperunreatoper ilquale√®gi√†statoassoltoocondannato nell'Unionea seguitodi \n una sentenzapenaledefinitivaconformementealla legge. IT C364/20 GazzettaufficialedelleComunit√†europee 18.12.2000CAPOVII DISPOSIZIONIGENERALI Articolo51 Ambitodi applicazione 1. Le disposizioni della presente Carta si applicano alle istituzioni e agli organi dell'Unione nel rispettodel principiodi sussidiariet√† come pure agli Statimembri esclusivamente nell'attuazione del dirittodell'Unione.Pertanto, i suddetti soggetti rispettanoidiritti,osservanoiprincipienepromuovono l'applicazione secondo le rispettivecompetenze. 2. La presente Carta non introduce competenze nuove o compiti nuovi per la Comunit√† e per l'Unione, n√©modifica lecompetenzee i compiti definiti dai trattati. Articolo52 Portatadeidiritti garantiti 1. Eventuali limitazioni all'eserciziodei diritti edelle libert√†riconosciuti dallapresenteCartadevono essereprevistedalla legge e rispettare il contenutoessenzialedi detti diritti e libert√†.Nel rispettodel principio di proporzionalit√†, possono essere apportate limitazioni solo laddove siano necessarie e rispondano effettivamente a finalit√† di interesse generale riconosciute dall'Unione o all'esigenza di proteggere i diritti e le libert√†altrui. 2. I diritti riconosciuti dalla presenteCarta che trovano fondamentonei trattati comunitari onel trattatosull'Unioneeuropea si esercitanoallecondizioni enei limiti definiti dai trattati stessi. 3. Laddove la presente Carta contenga diritti corrispondenti a quelli garantiti dalla convenzione europeaper la salvaguardiadei diritti dell'uomoedelle libert√† fondamentali, il significatoe laportata degli stessi sono uguali a quelli conferiti dalla suddetta convenzione. La presente disposizione non precludeche il dirittodell'Unioneconcedaunaprotezionepi√πestesa. Articolo53 Livellodiprotezione Nessuna disposizione dellapresenteCartadeve essere interpretata come limitativao lesiva dei diritti dell'uomo e delle libert√† fondamentali riconosciuti, nel rispettivo ambitodi applicazione, dal diritto dell'Unione,daldirittointernazionale,dalleconvenzioni internazionalidellequali l'Unione, laComunit√† otuttigliStatimembri sonoparti contraenti, inparticolare laconvenzioneeuropeaper lasalvaguardia dei diritti dell'uomoedelle libert√† fondamentali, edallecostituzioni degli Statimembri. IT 18.12.2000 GazzettaufficialedelleComunit√†europee C364/21Articolo54 Divietodell'abusodidiritto NessunadisposizionedellapresenteCartadeveessere interpretatanel sensodi comportare il dirittodi esercitareun'attivit√†ocompiereunattochemiri alladistruzionedei diritti odelle libert√† riconosciuti nellapresenteCartaodi imporre a tali diritti e libert√† limitazioni pi√πampiedi quelleprevistedalla presenteCarta."
    splitted_text = CharacterTextSplitter(
        separator='\n',
        chunk_size=500,
        chunk_overlap=50,
        length_function=len
    )
    return splitted_text.split_text(text)


def get_conversation(vectorstore):
    llm = ChatOpenAI()
    memory = ConversationBufferMemory(memory_key='chat_history', return_messages=True)
    conv_chain = ConversationalRetrievalChain.from_llm(
        llm=llm,
        retriever=vectorstore.as_retriever(),
        memory=memory
    )
    return conv_chain


def get_vectorstore(chunks):
    embedding = OpenAIEmbeddings(show_progress_bar=True)
    vectors = FAISS.from_texts(texts=chunks, embedding=embedding)
    return vectors


def handle_question(question):
    response = st.session_state.conversation({'question': question})
    st.session_state.chat_history = response['chat_history']

    for i, message in enumerate(st.session_state.chat_history):
        st.write(message.content)


def main():
    if "conversation" not in st.session_state:
        st.session_state.conversation = None

    if "chat_history" not in st.session_state:
        st.session_state.chat_history = None

    if 'splitted_text' not in st.session_state:
        st.session_state.splitted_text = None

    if 'vectors' not in st.session_state:
        st.session_state.vectors = None
        st.session_state.vectors = get_vectorstore(split_text('test'))

    st.title('ü´∏ü´∑:heart: LangChain first app')
    with st.sidebar:
        with st.echo():
            st.write("This code will be printed to the sidebar.")
        st.success("Done!")

    user_question = st.text_input('ask here about the document')
    if user_question:
        handle_question(user_question)
    st.session_state.conversation = get_conversation(st.session_state.vectors)


# Press the green button in the gutter to run the script.
if __name__ == '__main__':
    main()

# See PyCharm help at https://www.jetbrains.com/help/pycharm/
